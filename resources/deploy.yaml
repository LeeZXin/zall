processes:
  - name: 一号机器灰度发布
    agents:
      - host: 127.0.0.1:8080
        token: xxxxx
        id: agent1
        probe:
          type: tcp
          host: 127.0.0.1:8080
        with:
          ZALL_NODE_FLAG: v001
      - host: 127.0.0.1:8099
        token: xxxxx
        id: agent2
        probe:
          type: http
          url: http://128.0.0.1/health
      - host: 127.0.0.1:9999
        token: xxxxx
        id: agent3
    deploy:
      - name: 灰度第一批
        confirm:
          message: 是否灰度第一批
          agents: [ agent1 ]
          script: |
            set -e
            sdf
            sdf
            dsf
      - name: 灰度第二批
        confirm:
          message: 是否灰度第二批
          agents: [ agent2, agent3 ]
          script: |
            sdf
            sdf
            dsf
      - name: 回滚
        confirm:
          message: 是否回滚
          agents: [ agent1, agent2, agent3 ]
          form:
            - key: ALL_CONFIRM
              label: 是或否？
              regexp: '^(false|true)$'
          script: |
            set -e
            if $ALL_CONFIRM == 'true' {
              echo 'cnm'
            }
    actions:
      - name: restart
        confirm:
          message: 是否重启
          script: |
            sdf
            sdf
            sdf
      - name: stop
        confirm:
          message: 是否停止
          script: |
            sdf
            sdf
            sdf
      
        
        

      
      
        
            
          
